<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>Unibox beta vue</title>
		<script src='https://unpkg.com/vue@next/dist/vue.js'></script>
		<script src='https://unpkg.com/vue-router@2.0.2' ></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<style>
			.fade-enter-active, .fade-leave-active {
  		transition: opacity 2.5s
			}
			.fade-enter, .fade-leave-active {
  		opacity: 0
			}
		</style>
		<script src='https://unpkg.com/lodash'></script>

		<!-- START TEMPLATES -->
			<!-- START COURSE TEMPLATE -->
			<script id='course-template' type='text/x-template'>
				<tr>
						<td ><router-link v-bind:id='courseCode' v-bind:to='"/files/" +this.getCareer()+"/"+ courseCode'> {{courseCode}}</router-link></td>
						<td>{{courseName}}</td>
				</tr>
			</script>
			<!-- END COURSE TEMPLATE -->

			<!-- START FILES TEMPLATE -->
			<script id='files-template' type='text/x-template'>
					<div>
					<h1> Materia: {{$route.params.courseCode}} </h1>
					<h1> Archivos: </h1>
					<label class="btn btn-default btn-file">
					    Subir Archivos <input type="file" style="display: none;">
					</label>					<br>
				</div>
			</script>
			<!-- END FILES TEMPLATE -->

			<!-- START TABLE TEMPLATE -->
			<script id='table-template' type='text/x-template'>
			<div>

			<h1><a href='/'>  Unibox  </a></h1>

			<div  border=1px>
				<button class="btn btn-default" v-on:click="changeFilter('/files/admi/admi.json') , retrieveCourses()" > Administración</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/isis/isis.json'), retrieveCourses()" > Ing. Sistemas</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/mate/mate.json'), retrieveCourses()" >  Matemáticas</button>
			</div>
			<br>
			<div  border=1px>
				<button class="btn btn-default" v-on:click="changeFilter('/files/fisi/fisi.json') , retrieveCourses()" > Física</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/dere/dere.json') , retrieveCourses()" > Derecho</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/iind/iind.json') , retrieveCourses()" > Ing. Industrial</button>
			</div>
			<br>
			<div border=1px>
				<button class="btn btn-default" v-on:click="changeFilter('/files/econ/econ.json') , retrieveCourses()" > Economía</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/dise/dise.json') , retrieveCourses()" > Diseño </button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/arqu/arqu.json') , retrieveCourses()" > Arquitectura</button>
			</div>
			<br>
			<div border=1px>
				<button class="btn btn-default" v-on:click="changeFilter('/files/icya/icya.json') , retrieveCourses()" > Ing. Civil y Ambiental</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/quim/quim.json') , retrieveCourses()" > Química</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/biol/biol.json') , retrieveCourses()" > Biología</button>
			</div>
			<br>
			<div border=1px>
				<button class="btn btn-default" v-on:click="changeFilter('/files/medi/medi.json') , retrieveCourses()" > Medicina </button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/psic/psic.json') , retrieveCourses()" > Psicología</button>

			</div>
			<br>
			<br>
			<div class='row'>
			<div class="col-sm-4">
			<transition name='fade'>
			<router-view></router-view>

			</transition>
			</div>
			<div class="col-sm-4">
			<transition name='fade'>
				<table class='table table-hover table-responsive table-condensed' v-if='filtroSeleccionado'>
					<thead>
					<tr>
					<th>Codigo</th>
					<th>Nombre</th>
					</tr>
					</thead>
					<tbody>
					<component-course v-bind:courseCode='item.codigo' v-bind:courseName='item.nombre' v-for='item in content' v-if='filtroSeleccionado'></component-course>
					</tbody>
				</table>
			</transition>
		</div>
		</div>
		</div>
			</script>
			<!-- END TABLE TEMPLATE -->

		<!-- END TEMPLATES -->

		<!--  START COMPONENTS -->

			<!-- START COURSE COMPONENT -->
				<script>
					Vue.component('component-course',
					{
						template:'#course-template',
						data:function(){
							return{
							isSelected:false,
							files:[]
						}
						},
						props:{

							courseCode:{default:''},
							courseName:{default:''}
						},
						methods:{
							select:function(){
								this.isSelected=true;
							},
							getCareer:function(){
								var a= this.courseCode.substring(0,4).toLowerCase();
								return a;
							}
						}
					}
				)
				</script>
		<!-- END COURSE COMPONENT -->


			<!-- START TABLE COMPONENT -->
		<script>
			Vue.component('component-table',
			{
				template:'#table-template',
				data:function()
				{
					return {
						content:{},
						filter:'',
						filtroSeleccionado:false,
						myCareerFile:'/admi.json'
					};
				},

				props:
				{
					message:{default:'Hola Ignacio'},

				},
				methods:
				{

					changeShow:function()
					{
						this.active=!this.active;
					},

					retrieveCourses:function()
					{
						networkPromise = fetch(this.myCareerFile);
						networkPromise.then((rjson)=>{
								parsingPromise = rjson.json();
								parsingPromise.then((rcourses)=>{
									this.content=rcourses;
									console.log('importe correctamente')
								});
								parsingPromise.catch(function(){console.log('Error de parsear el archivo json');});
						});
						networkPromise.catch(function(){console.log('No encontre el arhivo admi.json')});
					},

					changeFilter:function(pFilter)
					{
						this.filter=pFilter,
						this.myCareerFile=pFilter;
						this.filtroSeleccionado=true;
						console.log('cambio de filtro a ' + pFilter);
					},

					isFiltered:function(courseCode)
					{
						if(courseCode.split(this.filter).length === 2)
						{
							return true;
						}
						else{
							return false;
						}
					}
				}
				}
			)
		</script>
			<!-- END TABLE COMPONENT -->
		<!-- END COMPONENTS -->

	</head>

	<body>
		<div id='app' align=center>
			<transition name='fade'>
			<component-table v-if='showTable'></component-table>
			</transition>

		</div>

		<script>
		const materia={
			template: '#files-template'
		}

		const router=new VueRouter({
			routes: [
				{ path: '/files/:career/:courseCode', component: materia  }

			]
		})


		var vm=new Vue(
			{
				el:'#app',
				router,
				data:{
					message:'Hola Vue',
					showTable:false,
					load:false
				}
			}
		);
		window.onload=function(){
				console.log('se ejecuta window load');
				vm.showTable=true;
				vm.load=false
		};

		</script>
	</body>
</html>
