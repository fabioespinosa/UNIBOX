<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>Unibox beta vue</title>
		<script src='https://unpkg.com/vue@next/dist/vue.js'></script>
		<script src='https://unpkg.com/vue-router@2.0.2' ></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.2/jquery.min.js'></script>
		<script src='client.js'></script>
		<!-- <script src='gradient.js'></script> -->
		<link rel="stylesheet" type="text/css" href="bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="style.css">
		<style>
			.fade-enter-active, .fade-leave-active {
  		transition: opacity 2.5s
			}
			.fade-enter, .fade-leave-active {
  		opacity: 0
			}
		</style>
		<script src='https://unpkg.com/lodash'></script>
		<!-- START TEMPLATES -->
			<!-- START COURSE TEMPLATE -->
			<script id='course-template' type='text/x-template'>
				<tr>
						<td ><router-link v-bind:id='courseCode' v-bind:to='"/" + this.getCareer()+"/"+ courseCode'> {{courseCode}}</router-link></td>
						<td>{{courseName}}</td>
				</tr>
			</script>
			<!-- END COURSE TEMPLATE -->

			<!-- START FILE TEMPLATE -->
			<script id='file-template' type='text/x-template'>
				<div>
				<li v-for="file in files"> <a :href='"files/" + file.path' > {{file.path.split("/")[3]}} </a> </li>
				<div>
			</script>
			<!-- END FILE TEMPLATE -->

			<!-- START FILE VIEWER TEMPLATE -->
			<script id='fileViewer-template' type='text/x-template'>
					<div>
					<h1> Materia: {{$route.params.courseCode}} </h1>
					<h1> Archivos: </h1>
					<label class="btn btn-default btn-file">
					    Subir Archivos <input type="file" style="display: none;" @change="onFileChange">
					</label>
					<br>
					<br>
						<div id=fileList>
							<component-file v-bind:files='this.files'></component-file>
						</div>
				</div>
			</script>
			<!-- END FILE VIEWER TEMPLATE -->


			<!-- START TABLE TEMPLATE -->
			<script id='table-template' type='text/x-template'>
			<div>

			<h1><a href='/'>  Unibox  </a></h1>

			<div  border=1px>
				<button class="btn btn-default" v-on:click="changeFilter('/files/admi/admi.json') , retrieveCourses()"> Administración</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/isis/isis.json'), retrieveCourses()" > Ing. Sistemas</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/mate/mate.json'), retrieveCourses()" >  Matemáticas</button>
			</div>
			<br>
			<div  border=1px>
				<button class="btn btn-default" v-on:click="changeFilter('/files/fisi/fisi.json') , retrieveCourses()" > Física</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/dere/dere.json') , retrieveCourses()" > Derecho</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/iind/iind.json') , retrieveCourses()" > Ing. Industrial</button>
			</div>
			<br>
			<div border=1px>
				<button class="btn btn-default" v-on:click="changeFilter('/files/econ/econ.json') , retrieveCourses()" > Economía</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/dise/dise.json') , retrieveCourses()" > Diseño </button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/arqu/arqu.json') , retrieveCourses()" > Arquitectura</button>
			</div>
			<br>
			<div border=1px>
				<button class="btn btn-default" v-on:click="changeFilter('/files/icya/icya.json') , retrieveCourses()" > Ing. Civil y Ambiental</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/quim/quim.json') , retrieveCourses()" > Química</button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/biol/biol.json') , retrieveCourses()" > Biología</button>
			</div>
			<br>
			<div border=1px>
				<button class="btn btn-default" v-on:click="changeFilter('/files/medi/medi.json') , retrieveCourses()" > Medicina </button>
				<button class="btn btn-default" v-on:click="changeFilter('/files/psic/psic.json') , retrieveCourses()" > Psicología</button>

			</div>
			<br>
			<br>
			<div class='row'>
			<div class="col-sm-4" v-if=''>
			<transition name='fade'>
				<router-view :route='$route.params'></router-view>
			</transition>
			</div>
			<div class="col-sm-4">
			<transition name='fade'>
				<table class='table table-hover table-responsive table-bordered' v-if='filtroSeleccionado'>
					<thead>
					<tr>
					<th>Codigo</th>
					<th>Nombre</th>
					</tr>
					</thead>
					<tbody>
					<component-course v-bind:courseCode='item.codigo' v-bind:courseName='item.nombre' v-for='item in content' v-if='filtroSeleccionado'></component-course>
					</tbody>
				</table>
			</transition>
		</div>
		</div>
		</div>
			</script>
			<!-- END TABLE TEMPLATE -->

		<!-- END TEMPLATES -->

		<!--  START COMPONENTS -->

		<!-- START FILE COMPONENT -->

		<script>
		Vue.component('component-file',
		{
			template:'#file-template',
			props:{
				files:{default:''}
			},
			methods:
			{
				// openFile:function(aPath){
				// 	const x=function(y){console.log(y)}
				// 	fsapi.open(aPath , x)
				// }
				}
		}
		)
		</script>

		<!-- END FILE COMPONENT -->

			<!-- START FILE VIEWER COMPONENT -->
			<script>

			const componentFileViewer=Vue.component('component-fileViewer',
			{
			template:'#fileViewer-template',
			data: function(){
				return {
				filesToUpload:'',
				fileName:'No has subido un archivo',
				fileSize:'No has subido un archivo',
				fileType:'No has subido un archivo',
				files:'holadata'
				};
			},
			watch:{
				$route : function(){
					this.getFiles()
					console.log("cambio la ruta")
				}
			},
			methods:
			{
				onFileChange : function(e)
				{
					this.filesToUpload = e.path[0].files[0];
					this.fileName=this.filesToUpload.name;
					this.fileSize=this.filesToUpload.size;
					this.fileType=this.filesToUpload.type;
					console.log("File to upload: Name: " + this.fileName +", Size: "+ this.fileSize + ", Type: "+ this.fileType);
				},
				getFiles:function()
				{
					//courseUrl start from the career folder. not from files
					const x=function(y,z){console.log(y,z)}
					const theUrl = this.$route.params.career + "/" + this.$route.params.courseCode

					const filePromise= new Promise( (resolve, reject)=>{
						fsapi.list( theUrl , (res)=>{
							console.log(res)
							this.files= res

							const temp11=res
								resolve(res.data)
						})
					})

					filePromise.then(function(data){
					})
				}

			}
			}
			)

			const router=new VueRouter({
				routes: [{ path: '/:career/:courseCode', component: componentFileViewer  }]
			})

			</script>
			<!-- END FILE VIEWER COMPONENT -->

			<!-- START COURSE COMPONENT -->
				<script>
					Vue.component('component-course',
					{
						template:'#course-template',
						data:function(){
							return{
							isSelected:false,
							files:[]
						}
						},
						props:{

							courseCode:{default:''},
							courseName:{default:''}
						},
						methods:{
							select:function(){
								this.isSelected=true;
							},
							getCareer:function(){
								var a= this.courseCode.substring(0,4).toLowerCase();
								return a;
							},

						}
					}
				)
				</script>
		<!-- END COURSE COMPONENT -->


			<!-- START TABLE COMPONENT -->
		<script>
			Vue.component('component-table',
			{
				template:'#table-template',
				data:function()
				{
					return {
						content:{},
						filter:'',
						filtroSeleccionado:false,
						myCareerFile:'/admi.json'
					};
				},

				props:
				{
					message:{default:'Hola Ignacio'},

				},
				methods:
				{

					changeShow:function()
					{
						this.active=!this.active;
					},

					retrieveCourses:function()
					{
						networkPromise = fetch(this.myCareerFile);
						networkPromise.then((rjson)=>{
								parsingPromise = rjson.json();
								parsingPromise.then((rcourses)=>{
									this.content=rcourses;
									console.log('importe correctamente')
								});
								parsingPromise.catch(function(){console.log('Error de parsear el archivo json');});
						});
						networkPromise.catch(function(){console.log('No encontre el arhivo admi.json')});
					},

					changeFilter:function(pFilter)
					{
						this.filter=pFilter,
						this.myCareerFile=pFilter;
						this.filtroSeleccionado=true;
						console.log('cambio de filtro a ' + pFilter);
					}
				}
				}
			)
		</script>
			<!-- END TABLE COMPONENT -->
		<!-- END COMPONENTS -->

	</head>

	<body>
		<div id='app' align=center>
			<transition name='fade'>
			<component-table v-if='showTable'></component-table>
			</transition>

		</div>

		<script>
		var vm=new Vue(
			{
				el:'#app',
				router,
				data:{
					message:'Hola Vue',
					showTable:false,
					load:false
				}
			}
		);
		window.onload=function(){
				console.log('se ejecuta window load');
				vm.showTable=true;
				vm.load=false
		};

		</script>
	</body>
</html>
